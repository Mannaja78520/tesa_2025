<!doctype html>
<html>
  <body style="font-family:sans-serif">
    <h3>WS Viewer</h3>
    <label>cam_id: <input id="cam" value="cam_01"></label>
    <button id="joinBtn">Join</button>

    <div style="margin:10px 0;">
      <button onclick="sendStatus('start')">Video START</button>
      <button onclick="sendStatus('stop')">Video STOP</button>
    </div>

    <img id="live" style="max-width:640px;border:1px solid #ccc">
    <pre id="meta" style="width:640px;background:#f7f7f7;"></pre>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
      const WS = "http://192.168.50.242:3000";  // แก้ IP server
      const s = io(WS, { transports:["websocket"] });

      const cam = document.getElementById('cam');
      document.getElementById('joinBtn').onclick = ()=> s.emit('join', {role:'web', cam_id: cam.value});

      s.on('connected', ()=> console.log('connected'));
      s.on('joined', d => console.log('joined', d));
      s.on('meta',  m => document.getElementById('meta').textContent = JSON.stringify(m, null, 2));
      s.on('image', p => { if (p.image_b64) document.getElementById('live').src = `data:image/${p.image_format||'jpeg'};base64,${p.image_b64}`; });
      s.on('pack',  p => {
        document.getElementById('meta').textContent = JSON.stringify(p, null, 2);
        if (p.image_b64) document.getElementById('live').src = `data:image/${p.image_format||'jpeg'};base64,${p.image_b64}`;
      });

      function sendStatus(status){
        s.emit('web:video_status', {cam_id: cam.value, status});
      }
    </script>
  </body>
</html>
